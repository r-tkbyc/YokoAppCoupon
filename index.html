<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Text Formatter v1.1.8 - 2026-01-23 -->
  <meta name="app-version" content="v1.1.8">

  <title>YokoAppCouponæµã—è¾¼ã¿ãƒ„ãƒ¼ãƒ«</title>
  <style>
  :root { --gap: 8px; }
  * { box-sizing: border-box; }
  body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Noto Sans JP, Helvetica, Arial, sans-serif; margin: 0; background: #0b0f14; color: #e6edf3; }
  header { padding: 10px 14px; border-bottom: 1px solid #22303e; background: #0f1620; }
  h1 { margin: 0; font-size: 18px; font-weight: 700; }
  main { padding: 12px; max-width: 1200px; margin: 0 auto; }

  .set { display: flex; flex-direction: column; gap: var(--gap); margin-top: 14px; background: #0f1620; border: 1px solid #22303e; border-radius: 8px; padding: 8px; }
  .set-head { display: flex; align-items: center; justify-content: space-between; gap: 6px; }
  .set-title { margin: 0; font-size: 13px; color: #c9d6e2; font-weight: 700; }
  .actions { display: flex; gap: 6px; align-items: center; }

  .row { display: grid; grid-template-columns: 1fr; gap: var(--gap); }
  @media (min-width: 960px) { .row { grid-template-columns: 1fr 1fr; } }

  .stack { display:flex; flex-direction:column; gap: var(--gap); }

  .panel { background: #0b121a; border: 1px solid #22303e; border-radius: 6px; padding: 8px; display: flex; flex-direction: column; gap: 6px; }
  .panel h2 { margin: 0 0 2px; font-size: 12px; font-weight: 700; color: #9fb3c8; }

  textarea { width: 100%; min-height: 60px; resize: vertical; background: #0b121a; color: #e6edf3; border: 1px solid #22303e; border-radius: 6px; padding: 10px; line-height: 1.45; font-size: 13px; }
  textarea[readonly] { opacity: .95; }

  button { cursor: pointer; border: 1px solid #2a3a4b; background: #132032; color: #e6edf3; border-radius: 6px; padding: 6px 10px; font-size: 12px; }
  button:hover { background: #18283d; }
  button:active { transform: translateY(1px); }
  .primary { background: #2155cd; border-color: #2155cd; }

  .toast { position: fixed; left: 50%; bottom: 24px; transform: translateX(-50%); background: rgba(20,30,45,.95); border: 1px solid #2a3a4b; padding: 10px 14px; border-radius: 10px; color: #e6edf3; font-size: 13px; opacity: 0; pointer-events: none; transition: opacity .25s ease; }
  .toast.show { opacity: 1; }

  /* === Unity-like compact theme overrides (CSS-only) === */
  :root { --gap: 6px; }
  body { background:#383838; color:#dcdcdc; }
  header { background:#383838; border-bottom:1px solid #222; padding:8px 12px; }
  h1 { font-size:14px; font-weight:600; color:#dcdcdc; }
  main { padding:10px; }
  .set { background:#383838; border:1px solid #222; border-radius:2px; padding:6px; margin-top:10px; }
  .set-title { font-size:12px; color:#e0e0e0; }
  .actions { gap:5px; }
  .panel { background:#383838; border:1px solid #222; border-radius:2px; padding:6px; gap:6px; }
  .panel h2 { font-size:11px; color:#bfbfbf; margin:0 0 2px; font-weight:600; }
  textarea { background:#2a2a2a; border:1px solid #3b3b3b; border-radius:2px; color:#e3e3e3; padding:8px; line-height:1.4; font-size:12px; }
  textarea[readonly]{opacity:.98;}
  textarea:focus, select:focus, input:focus, button:focus { outline:1px solid #2a81fb; outline-offset:0; box-shadow:0 0 0 1px #2a81fb inset; }
  button { background:#585858; border:1px solid #111111; color:#eaeaea; border-radius:2px; padding:4px 8px; font-size:12px; }
  button:hover { background:#4a4a4a; }
  button:active { background:#5a5a5a; transform:none; }
  .primary { background:#585858; border-color:#222; color:#ffffff; }
  .toast { background:rgba(46,46,46,.98); border:1px solid #3b3b3b; color:#dedede; font-size:12px; }

  :root { --gap: 4px; }
  header { padding: 6px 10px; }
  .set { padding: 4px; margin-top: 8px; }
  .set-title { font-size: 11.5px; }
  .actions { gap: 4px; }
  .panel { padding: 4px; gap: 4px; }
  .panel h2 { font-size: 11px; margin: 0 0 1px; }
  textarea { padding: 6px; line-height: 1.35; font-size: 12px; min-height: 60px; }
  button { padding: 3px 8px; font-size: 11px; }
  .toast { font-size: 11px; padding: 8px 10px; }

  body { font-size: 12px; }
  h1 { font-size: 13px; }
  .set-title { font-size: 11px; }
  .panel h2 { font-size: 10px; }
  textarea { font-size: 11px; line-height: 1.3; }
  button { font-size: 10px; padding: 2px 7px; }
  .toast { font-size: 10.5px; padding: 6px 8px; }

  :root { --btn-h: 20px; }
  button { height: var(--btn-h); padding: 0 8px !important; line-height: calc(var(--btn-h) - 2px); }
  header { display:flex; align-items:center; justify-content:space-between; }
  .ver-badge { font-size:10px; background:#3d3d3d; border:1px solid #565656; color:#eaeaea;
    border-radius:2px; padding:0 6px; line-height:18px; height:18px; white-space:nowrap; }

  .quad-row{
    display:grid;
    grid-template-columns: 1fr;
    gap: var(--gap);
  }
  @media (min-width: 960px){
    .quad-row{
      grid-template-columns: 1fr 1fr 1fr 1fr;
    }
  }

  /* 3åˆ—ï¼ˆã‚¯ãƒ¼ãƒãƒ³åˆ©ç”¨æ¡ä»¶ç”¨ï¼‰ */
  .tri-row{
    display:grid;
    grid-template-columns: 1fr;
    gap: var(--gap);
  }
  @media (min-width: 960px){
    .tri-row{
      grid-template-columns: 1fr 1fr 1fr;
    }
  }

  input, select{
    width: 100%;
    height: var(--btn-h);
    background:#585858;
    border:1px solid #111111;
    color:#eaeaea;
    border-radius:2px;
    padding: 0 8px;
    font-size: 10px;
    line-height: calc(var(--btn-h) - 2px);
    appearance: none;
  }
  select{
    padding-right: 22px;
    background-image:
      linear-gradient(45deg, transparent 50%, #eaeaea 50%),
      linear-gradient(135deg, #eaeaea 50%, transparent 50%);
    background-position:
      calc(100% - 14px) calc(50% - 2px),
      calc(100% - 9px) calc(50% - 2px);
    background-size: 5px 5px, 5px 5px;
    background-repeat: no-repeat;
  }
  input[type="number"]{ appearance: textfield; }
  input[type="number"]::-webkit-outer-spin-button,
  input[type="number"]::-webkit-inner-spin-button{ -webkit-appearance: none; margin:0; }

  /* æ—¥æ™‚ï¼šãƒ†ã‚­ã‚¹ãƒˆï¼‹ãƒ”ãƒƒã‚«ãƒ¼ï¼ˆğŸ“…ã®ä¸Šã« datetime-local ã‚’é€æ˜ã§é‡ã­ã‚‹ï¼‰ */
  .dt-line{
    display:flex;
    gap: var(--gap);
    align-items:center;
  }
  .dt-line input.dt-text{
    flex: 1;
    min-width: 0;
  }
  .dt-picker{
    position: relative;
    width: 28px;
    height: var(--btn-h);
    flex: 0 0 28px;
    cursor: pointer;               /* ã©ã“ã§ã‚‚æ‰‹ã‚«ãƒ¼ã‚½ãƒ« */
  }

  .dt-picker .dt-ico{
    position: relative;
    z-index: 1;
    width: 100%;
    height: 100%;
    display:flex;
    align-items:center;
    justify-content:center;
    border:1px solid #111111;
    background:#585858;
    border-radius:2px;
    user-select:none;
    pointer-events: none;          /* â˜…è¦‹ãŸç›®ã ã‘ï¼šãƒ›ãƒãƒ¼/ã‚¯ãƒªãƒƒã‚¯ã‚’å—ã‘ãªã„ */
  }

  .dt-picker input.dt-overlay{
    position:absolute;
    inset:0;
    z-index: 2;                    /* â˜…å¸¸ã«æœ€å‰é¢ */
    width:100%;
    height:100%;
    opacity:0;
    cursor:pointer;                /* â˜…ã©ã“ã§ã‚‚æ‰‹ã‚«ãƒ¼ã‚½ãƒ« */
    border:0;
    padding:0;
    margin:0;
    background:transparent;
    color:transparent;
    pointer-events: none;
  }

  .mono{
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    letter-spacing: 0.1px;
  }
  </style>
</head>

<body>
  <header>
    <h1>YokoAppCouponæµã—è¾¼ã¿ãƒ„ãƒ¼ãƒ«</h1>
    <button id="ver" class="ver-badge"></button>
  </header>

  <main>
    <!-- ã‚¿ã‚¤ãƒˆãƒ« / ç®¡ç†åç§° -->
    <section class="set" data-set="title">
      <div class="set-head">
        <h2 class="set-title">ã‚¿ã‚¤ãƒˆãƒ« / ç®¡ç†åç§°</h2>
        <div class="actions">
          <!-- â€»toCMSãƒœã‚¿ãƒ³ã¯æ‹¡å¼µå´ï¼ˆkoma_injectï¼‰ã§ã“ã“ã«æŒ¿å…¥ã™ã‚‹æƒ³å®š -->
          <button class="btn-convert primary" title="å¤‰æ›ï¼ˆCtrl/Cmd+Enterï¼‰">&nbsp;å¤‰æ›&nbsp;</button>
        </div>
      </div>

      <div class="row">
        <section class="panel">
          <h2>å…¥åŠ›</h2>
          <textarea class="input" placeholder="ã“ã“ã«ãƒ†ã‚­ã‚¹ãƒˆã‚’ãƒšãƒ¼ã‚¹ãƒˆ"></textarea>
        </section>

        <div class="stack">
          <section class="panel">
            <h2>å‡ºåŠ›ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ï¼‰</h2>
            <textarea class="output-title" placeholder="ã“ã“ã«æ•´å½¢çµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™" readonly></textarea>
          </section>

          <section class="panel">
            <h2>å‡ºåŠ›ï¼ˆç®¡ç†åç§°ï¼‰</h2>
            <textarea class="output-admin" placeholder="ã“ã“ã«æ•´å½¢çµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™" readonly></textarea>
          </section>
        </div>
      </div>
    </section>

    <!-- ãƒ¡ã‚¿ -->
    <section class="set" data-set="meta">
      <div class="set-head">
        <h2 class="set-title">éƒ¨é–€ / å…ˆç€äººæ•° / è¡¨ç¤ºã‚°ãƒ«ãƒ¼ãƒ— / ã‚«ãƒ†ã‚´ãƒª</h2>
        <div class="actions"></div>
      </div>

      <div class="quad-row">
        <section class="panel" data-field="division">
          <h2>éƒ¨é–€</h2>
          <select id="division">
            <option value="" selected>é¸æŠã—ã¦ãã ã•ã„</option>
            <option value="â‘ ">â‘ </option>
            <option value="â‘¡">â‘¡</option>
            <option value="â‘¢">â‘¢</option>
            <option value="â‘£">â‘£</option>
            <option value="â‘¤">â‘¤</option>
            <option value="å‘‰æœ">å‘‰æœ</option>
            <option value="ç¾è¡“">ç¾è¡“</option>
          </select>
        </section>

        <section class="panel" data-field="first-come">
          <h2>å…ˆç€äººæ•°</h2>
          <input id="firstCome" type="number" min="0" step="1" placeholder="ä¾‹ï¼š30">
        </section>

        <section class="panel" data-field="display-group">
          <h2>è¡¨ç¤ºã‚°ãƒ«ãƒ¼ãƒ—</h2>
          <select id="displayGroup">
            <option value="" selected>é¸æŠã—ã¦ãã ã•ã„</option>
            <option value="ãƒ“ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ¼">ãƒ“ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ¼</option>
            <option value="ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³">ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³</option>
            <option value="å‚¬ãƒ»ã‚¤ãƒ™ãƒ³ãƒˆ">å‚¬ãƒ»ã‚¤ãƒ™ãƒ³ãƒˆ</option>
            <option value="ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³">ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³</option>
            <option value="ã‚°ãƒ«ãƒ¡">ã‚°ãƒ«ãƒ¡</option>
            <option value="ã‚­ãƒƒã‚º">ã‚­ãƒƒã‚º</option>
            <option value="ãƒ©ã‚¤ãƒ•ã‚¹ã‚¿ã‚¤ãƒ«">ãƒ©ã‚¤ãƒ•ã‚¹ã‚¿ã‚¤ãƒ«</option>
          </select>
        </section>

        <section class="panel" data-field="category">
          <h2>ã‚«ãƒ†ã‚´ãƒª</h2>
          <select id="category">
            <option value="" selected>é¸æŠã—ã¦ãã ã•ã„</option>
            <option value="ã‚¢ãƒ—ãƒªã‚¯ãƒ¼ãƒãƒ³" selected>ã‚¢ãƒ—ãƒªã‚¯ãƒ¼ãƒãƒ³</option>
            <option value="ã‚¢ãƒ—ãƒªä¼šå“¡æ§˜é™å®šãƒã‚¤ãƒ³ãƒˆã‚¢ãƒƒãƒ—">ã‚¢ãƒ—ãƒªä¼šå“¡æ§˜é™å®šãƒã‚¤ãƒ³ãƒˆã‚¢ãƒƒãƒ—</option>
          </select>
        </section>
      </div>
    </section>

    <!-- ãƒ•ãƒ­ã‚¢ãƒ»å£²å ´ / ãƒ–ãƒ©ãƒ³ãƒ‰å -->
    <section class="set" data-set="floor-brand">
      <div class="set-head">
        <h2 class="set-title">ãƒ•ãƒ­ã‚¢ãƒ»å£²å ´ / ãƒ–ãƒ©ãƒ³ãƒ‰å</h2>
        <div class="actions"></div>
      </div>

      <!-- 1è¡Œç›®ï¼šãƒ•ãƒ­ã‚¢ãƒ»å£²å ´ -->
      <div class="row">
        <section class="panel">
          <h2>å…¥åŠ›ï¼ˆãƒ•ãƒ­ã‚¢ãƒ»å£²å ´ï¼‰</h2>
          <textarea class="input-floor" placeholder="1éš åŒ–ç²§å“"></textarea>
        </section>

        <section class="panel">
          <h2>å‡ºåŠ›ï¼ˆãƒ–ãƒ©ãƒ³ãƒ‰å…¥å±…ãƒ•ãƒ­ã‚¢ï¼‰</h2>
          <textarea class="output-floor" placeholder="ã“ã“ã«æ•´å½¢çµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™" readonly></textarea>
        </section>
      </div>

      <!-- 2è¡Œç›®ï¼šãƒ–ãƒ©ãƒ³ãƒ‰å -->
      <div class="row">
        <section class="panel">
          <h2>å…¥åŠ›ï¼ˆãƒ–ãƒ©ãƒ³ãƒ‰åï¼‰</h2>
          <textarea class="input-brand" placeholder="ã‚¨ã‚¹ãƒˆ"></textarea>
        </section>

        <section class="panel">
          <h2>å‡ºåŠ›ï¼ˆãƒ–ãƒ©ãƒ³ãƒ‰åï¼‰</h2>
          <textarea class="output-brand" placeholder="ã“ã“ã«æ•´å½¢çµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™" readonly></textarea>
        </section>
      </div>
    </section>

    <!-- ã”åˆ©ç”¨æ¡ä»¶ -->
    <section class="set" data-set="terms">
      <div class="set-head">
        <h2 class="set-title">ã”åˆ©ç”¨æ¡ä»¶</h2>
        <div class="actions"></div>
      </div>

      <div class="row">
        <section class="panel">
          <h2>å…¥åŠ›</h2>
          <textarea class="input-terms" placeholder="ã“ã“ã«ãƒ†ã‚­ã‚¹ãƒˆã‚’ãƒšãƒ¼ã‚¹ãƒˆ"></textarea>
        </section>

        <section class="panel">
          <h2>å‡ºåŠ›</h2>
          <textarea class="output-terms" placeholder="ã“ã“ã«æ•´å½¢çµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™" readonly></textarea>
        </section>
      </div>
    </section>

    <!-- æ³¨æ„äº‹é … -->
    <section class="set" data-set="notes">
      <div class="set-head">
        <h2 class="set-title">æ³¨æ„äº‹é …</h2>
        <div class="actions"></div>
      </div>

      <div class="row">
        <section class="panel">
          <h2>å…¥åŠ›</h2>
          <textarea class="input-notes" placeholder="ã“ã“ã«ãƒ†ã‚­ã‚¹ãƒˆã‚’ãƒšãƒ¼ã‚¹ãƒˆ"></textarea>
        </section>

        <section class="panel">
          <h2>å‡ºåŠ›</h2>
          <textarea class="output-notes" placeholder="ã“ã“ã«æ•´å½¢çµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™" readonly></textarea>
        </section>
      </div>
    </section>

    <!-- ã‚¯ãƒ¼ãƒãƒ³åˆ©ç”¨æ¡ä»¶ -->
    <section class="set" data-set="usage">
      <div class="set-head">
        <h2 class="set-title">ã‚¯ãƒ¼ãƒãƒ³åˆ©ç”¨æ¡ä»¶</h2>
        <div class="actions"></div>
      </div>

      <div class="quad-row">
        <section class="panel">
          <h2>ä¼šå“¡ã²ã¨ã‚ŠãŒåˆ©ç”¨å¯èƒ½ãªå›æ•°</h2>
          <input id="perMemberLimit" type="number" min="0" step="1" value="1" placeholder="ä¾‹ï¼š1">
        </section>

        <section class="panel">
          <h2>å…¨ä½“ã®åˆ©ç”¨å›æ•°åˆ¶é™</h2>
          <select id="overallLimit">
            <option value="ãªã—" selected>ãªã—</option>
            <option value="ã‚ã‚Š">ã‚ã‚Š</option>
          </select>
        </section>

        <section class="panel">
          <h2>å…¨ä½“ã§åˆ©ç”¨å¯èƒ½ãªå›æ•°</h2>
          <input id="overallTotal" type="number" min="0" step="1" placeholder="ï¼ˆå¤‰æ›ã§åæ˜ ï¼‰">
        </section>
        
        <section class="panel">
          <h2>é…å¸ƒæ–¹æ³•</h2>
          <select id="distributionMethod">
            <option value="å…¨å“¡ã«é…å¸ƒ" selected>å…¨å“¡ã«é…å¸ƒ</option>
            <option value="ä¼šå“¡ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«æ¡ä»¶ã‚’æŒ‡å®šã—ã¦é…å¸ƒ">ä¼šå“¡ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«æ¡ä»¶ã‚’æŒ‡å®šã—ã¦é…å¸ƒ</option>
            <option value="ä»®ä¼šå“¡ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«æ¡ä»¶ã‚’æŒ‡å®šã—ã¦é…å¸ƒ">ä»®ä¼šå“¡ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«æ¡ä»¶ã‚’æŒ‡å®šã—ã¦é…å¸ƒ</option>
            <option value="ä¼šå“¡ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ä¼šå“¡çµ±åˆ ID ã‚’æŒ‡å®šã—ã¦é…å¸ƒ">ä¼šå“¡ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ä¼šå“¡çµ±åˆ ID ã‚’æŒ‡å®šã—ã¦é…å¸ƒ</option>
            <option value="ä¼šå“¡ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«äºŒæ¬¡å…ƒã‚³ãƒ¼ãƒ‰ãƒ»URLã§é…å¸ƒ">ä¼šå“¡ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«äºŒæ¬¡å…ƒã‚³ãƒ¼ãƒ‰ãƒ»URLã§é…å¸ƒ</option>
          </select>
        </section>
        
      </div>
    </section>

    <!-- â˜… æ—¥æ™‚è¨­å®šï¼ˆæœ€ä¸‹éƒ¨ã¸ç§»å‹• / 3è¡ŒÃ—2åˆ—ï¼‰ -->
    <section class="set" data-set="datetime">
      <div class="set-head">
        <h2 class="set-title">æ—¥æ™‚è¨­å®š</h2>
        <div class="actions">
          <select id="baseYear" data-persist="1" title="åŸºæº–å¹´ï¼ˆãƒªã‚»ãƒƒãƒˆã—ã¦ã‚‚ä¿æŒï¼‰">
            <option value="2026">2026</option>
            <option value="2027">2027</option>
            <option value="2028">2028</option>
            <option value="2029">2029</option>
            <option value="2030">2030</option>
          </select>
        </div>
      </div>

      <!-- 1è¡Œç›®ï¼šé–‹å§‹ -->
      <div class="row">
        <section class="panel">
          <h2>å…¥åŠ›ï¼ˆé–‹å§‹æ—¥æ™‚ï¼‰</h2>
          <div class="dt-line">
            <input class="dt-text mono" id="dtStartIn" type="text" placeholder="ä¾‹ï¼š2/18ï¼ˆæ°´ï¼‰ / 8æœˆ11æ—¥">
            <div class="dt-picker" title="æ—¥æ™‚ã‚’é¸æŠ">
              <div class="dt-ico">ğŸ“…</div>
              <input class="dt-overlay" id="dtStartPicker" type="datetime-local" />
            </div>
          </div>
        </section>

        <section class="panel">
          <h2>å‡ºåŠ›ï¼ˆåˆ©ç”¨å¯èƒ½æœŸé–“ / é–‹å§‹æ—¥æ™‚ï¼‰</h2>
          <input class="mono" id="dtUsableStartOut" type="text" readonly placeholder="ï¼ˆå¤‰æ›ã§åæ˜ ï¼‰">
        </section>
      </div>

      <!-- 2è¡Œç›®ï¼šçµ‚äº†ï¼ˆå‡ºåŠ›ã¯çµ±åˆï¼‰ -->
      <div class="row">
        <section class="panel">
          <h2>å…¥åŠ›ï¼ˆçµ‚äº†æ—¥æ™‚ï¼‰</h2>
          <div class="dt-line">
            <input class="dt-text mono" id="dtEndIn" type="text" placeholder="ä¾‹ï¼š3/4 / 1/10">
            <div class="dt-picker" title="æ—¥æ™‚ã‚’é¸æŠ">
              <div class="dt-ico">ğŸ“…</div>
              <input class="dt-overlay" id="dtEndPicker" type="datetime-local" />
            </div>
          </div>
        </section>

        <section class="panel">
          <h2>å‡ºåŠ›ï¼ˆå…¬é–‹æœŸé–“ãƒ»åˆ©ç”¨å¯èƒ½æœŸé–“ / çµ‚äº†æ—¥æ™‚ï¼‰</h2>
          <input class="mono" id="dtEndOutCombined" type="text" readonly placeholder="ï¼ˆå¤‰æ›ã§åæ˜ ï¼‰">
          <!-- äº’æ›ç”¨ï¼šå°†æ¥ãƒãƒƒãƒ”ãƒ³ã‚°ã§åˆ¥IDãŒå¿…è¦ã«ãªã£ã¦ã‚‚å›°ã‚‰ãªã„ã‚ˆã†ã«éš ã—ã§ä¿æŒ -->
          <input id="dtPublishEndOut" type="text" style="display:none" readonly>
          <input id="dtUsableEndOut" type="text" style="display:none" readonly>
        </section>
      </div>

      <!-- 3è¡Œç›®ï¼šé…å¸ƒå¸Œæœ›ï¼ˆå…¬é–‹é–‹å§‹ï¼‰ -->
      <div class="row">
        <section class="panel">
          <h2>å…¥åŠ›ï¼ˆé…å¸ƒå¸Œæœ›æ—¥æ™‚ï¼‰</h2>
          <div class="dt-line">
            <input class="dt-text mono" id="dtWishIn" type="text" placeholder="æœªè¨˜å…¥ãªã‚‰é–‹å§‹ã®1æ—¥å‰ 17:00">
            <div class="dt-picker" title="æ—¥æ™‚ã‚’é¸æŠ">
              <div class="dt-ico">ğŸ“…</div>
              <input class="dt-overlay" id="dtWishPicker" type="datetime-local" />
            </div>
          </div>
        </section>

        <section class="panel">
          <h2>å‡ºåŠ›ï¼ˆå…¬é–‹æœŸé–“ / é–‹å§‹æ—¥æ™‚ï¼‰</h2>
          <input class="mono" id="dtPublishStartOut" type="text" readonly placeholder="ï¼ˆå¤‰æ›ã§åæ˜ ï¼‰">
        </section>
      </div>
    </section>
  </main>

  <div class="toast" id="toast"></div>

  <script>
  const APP_VERSION = "v1.1.8";
  const APP_BUILD = "2026-01-23";
  const PRICE_SPACE_RULE_ENABLED = false;

  // æ—¥æ™‚è¨­å®šï¼šåŸºæº–å¹´ã®åˆæœŸå€¤ï¼ˆä»Šå¹´ã¯2026ï¼‰
  const DEFAULT_BASE_YEAR = "2026";
  const LS_BASE_YEAR_KEY = "yk_base_year_v1";

  document.addEventListener("DOMContentLoaded", () => {
    const el = document.getElementById("ver");
    if (el) el.textContent = `${APP_VERSION} (${APP_BUILD})`;

    // åŸºæº–å¹´ï¼šlocalStorageå„ªå…ˆã§å¾©å…ƒ
    const by = document.getElementById("baseYear");
    if (by){
      const saved = localStorage.getItem(LS_BASE_YEAR_KEY);
      const val = (saved && saved.trim()) ? saved.trim() : DEFAULT_BASE_YEAR;
      if ([...by.options].some(o => o.value === val)) by.value = val;
      by.addEventListener("change", () => localStorage.setItem(LS_BASE_YEAR_KEY, by.value));
    }

    wirePickers();
  });

  // =============================
  //  ãƒ«ãƒ¼ãƒ«é©ç”¨ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ï¼ˆå…¨ä½“ï¼‰
  // =============================
  const rulesGlobal = [];

  rulesGlobal.push(function urlProtect(s){
    const urlRegex = /(https?:\/\/[!-~]+)/g;
    const bucket = [];
    const out = String(s||'').replace(urlRegex, (m) => {
      const half = m
        .replace(/[ï¼¡-ï¼ºï½-ï½šï¼-ï¼™]/g, ch => String.fromCharCode(ch.charCodeAt(0)-0xFEE0))
        .replace(/[ï¼-ï½]/g,       ch => String.fromCharCode(ch.charCodeAt(0)-0xFEE0))
        .replace(/[â€â€•ï¼ãƒ¼â€’â€“â€”âˆ’]/g, '-');
      const key = `âŸ¦URL${bucket.length}âŸ§`;
      bucket.push(half);
      return key;
    });
    return { text: out, ctx: { urls: bucket } };
  });

  rulesGlobal.push(function siCompatUnits(s){
    return String(s||'').replace(/\u339D/g, 'cm')
                        .replace(/\u3396/g, 'ml')
                        .replace(/\u339C/g, 'mm');
  });

  rulesGlobal.push(function fullwidthBracketsAndWave(s){
    return String(s||'')
      .replace(/\[/g, 'ï¼»')
      .replace(/\]/g, 'ï¼½')
      .replace(/[\u007E\u301C]/g, 'ï½')
      .replace(/â†’/g, 'ï½');
  });

  rulesGlobal.push(function lexicalReplacements(s){
    return String(s || '')
      .replace(/POPUPSTORE/g, 'POP UP STORE')
      .replace(/POPUPSHOP/g, 'POP UP SHOP')
      .replace(/POPUP/g, 'POP UP')
      .replace(/æ˜¯é/g, 'ãœã²')
      .replace(/ãã ã•ã„ã¾ã›/g, 'ãã ã•ã„')
      .replace(/ãŠè²·ã„ä¸Šã’/g, 'ãŠè²·ä¸Šã’')
      .replace(/ãŠè²·ã„ã‚ã’/g, 'ãŠè²·ä¸Šã’')
      .replace(/è‡´ã—ã¾ã™/g, 'ã„ãŸã—ã¾ã™')
      .replace(/ãƒ©ã‚¤ãƒ³ãƒŠãƒƒãƒ—/g, 'ãƒ©ã‚¤ãƒ³ã‚¢ãƒƒãƒ—')
      .replace(/é«™å³¶å±‹/g, 'é«˜å³¶å±‹');
  });

  rulesGlobal.push(function widthNorm(s){
    const toHalfAlnum = x => x.replace(/[ï¼¡-ï¼ºï½-ï½šï¼-ï¼™]/g, ch => String.fromCharCode(ch.charCodeAt(0)-0xFEE0));
    const toHalfDigits= x => x.replace(/[ï¼-ï¼™]/g,           ch => String.fromCharCode(ch.charCodeAt(0)-0xFEE0));
    const toFullWidthSymbols = x => x.replace(/[\x21-\x7E]/g, ch => {
      if (/[A-Za-z0-9]/.test(ch)) return ch;
      if (ch === ' ') return ch;
      return String.fromCharCode(ch.charCodeAt(0) + 0xFEE0);
    });
    let body = toHalfAlnum(s);
    body = toFullWidthSymbols(body);
    body = toHalfDigits(body);
    body = body
      .replace(/\(/g,'ï¼ˆ').replace(/\)/g,'ï¼‰')
      .replace(/\[/g,'ï¼»').replace(/\]/g,'ï¼½')
      .replace(/\{/g,'ï½›').replace(/\}/g,'ï½')
      .replace(/</g,'ï¼œ').replace(/>/g,'ï¼')
      .replace(/ï¼œ/g,'ã€ˆ').replace(/ï¼/g,'ã€‰')
      .replace(/â‰ª/g,'ã€Š').replace(/â‰«/g,'ã€‹')
      .replace(/ã€/g,'ã€”').replace(/ã€‘/g,'ã€•')
      .replace(/\*/g,'â€»').replace(/ï¼Š/g,'â€»');
    body = body.replace(/[A-Za-z0-9ï¼-ï¼™]+[\p{P}\p{S}]+(?=[A-Za-z0-9ï¼-ï¼™]+)/gu, seg =>
      seg.replace(/[ï¼-ï½]/g, ch => {
        const keep = 'ï¼ˆï¼‰ï¼»ï¼½ï½›ï½ã€Œã€ã€ã€ã€Šã€‹ã€”ã€•ã€ˆã€‰';
        if (keep.includes(ch)) return ch;
        return String.fromCharCode(ch.charCodeAt(0) - 0xFEE0);
      }).replace(/[â€â€•ï¼ãƒ¼â€’â€“â€”âˆ’]/g, '-')
    );
    return body;
  });

  rulesGlobal.push(function fixTelColon(s){
    return String(s || '').replace(/\bTEL[:ï¼š]/g, 'TELï¼š');
  });

  rulesGlobal.push(function spaceBreak(s){
    return String(s||'')
      .replace(/[ ã€€]+/g,' ')
      .replace(/(\r?\n){3,}/g,'\n\n');
  });

  rulesGlobal.push(function ensureZenkakuSpaceBeforePrice(s){
    if (!PRICE_SPACE_RULE_ENABLED) return s;
    const str = String(s || '');
    const priceRe = /([ ã€€]*)(\d{1,3}(?:,\d{3})+|\d+)([ ã€€]*å††)/g;

    return str.replace(priceRe, (match, ws, num, yenPart, offset) => {
      const prev = str.slice(0, offset);
      const next = str.slice(offset + match.length);

      if (prev.endsWith('ç¨è¾¼') && next.startsWith('ä»¥ä¸Š')) return match;

      const prevChar = prev.slice(-1);
      const atLineStart = offset === 0 || prevChar === '\n' || prevChar === '\r';
      if (atLineStart) return `${num}${yenPart}`;

      return `ã€€${num}${yenPart}`;
    });
  });

  rulesGlobal.push(function urlRestore(s, ctx){
    return String(s||'').replace(/âŸ¦URL(\d+)âŸ§/g, (_, i) => (ctx.urls||[])[Number(i)] ?? '');
  });

  function transform(text){
    let ctx = {};
    let current = String(text||'');
    for (const rule of rulesGlobal){
      const r = rule(current, ctx);
      if (typeof r === 'string'){ current = r; }
      else if (r && typeof r === 'object' && 'text' in r){
        current = r.text;
        ctx = { ...(ctx||{}), ...(r.ctx||{}) };
      }
    }
    return current;
  }

  const toastEl = document.getElementById('toast');
  function toast(msg){
    toastEl.textContent = msg;
    toastEl.classList.add('show');
    clearTimeout(toast._t);
    toast._t = setTimeout(()=>toastEl.classList.remove('show'), 1200);
  }

  // =============================
  //  æ—¥æ™‚è¨­å®šï¼šãƒ‘ãƒ¼ã‚¹ï¼†æ•´å½¢
  // =============================
  function pad2(n){ return String(n).padStart(2,'0'); }

  function fmtYmdHm(d){
    const y = d.getFullYear();
    const m = pad2(d.getMonth()+1);
    const da= pad2(d.getDate());
    const h = pad2(d.getHours());
    const mi= pad2(d.getMinutes());
    return `${y}/${m}/${da} ${h}:${mi}`;
  }

  function toHalfDigits(s){
    return String(s||'').replace(/[ï¼-ï¼™]/g, ch => String.fromCharCode(ch.charCodeAt(0)-0xFEE0));
  }

  function stripWeekday(s){
    return String(s||'')
      .replace(/[ï¼ˆ(][^ï¼‰)]*[ï¼‰)]/g,'')
      .trim();
  }

  function parseDateTimeLoose(text, baseYear){
    let s = transform(toHalfDigits(text || '')).trim();
    s = stripWeekday(s);
    if (!s) return { ok:false };

    // æ™‚åˆ»
    let hour = null, minute = null, hasTime = false;
    const tm = s.match(/(\d{1,2})\s*:\s*(\d{2})/);
    if (tm){
      hour = Number(tm[1]);
      minute = Number(tm[2]);
      hasTime = true;
    }

    // å¹´æœˆæ—¥
    let year = null, month = null, day = null, hasYear = false;

    // 1) YYYY/MM/DD or YYYY-MM-DD or YYYYå¹´MæœˆDæ—¥
    let m = s.match(/(\d{4})\s*[\/\-\.å¹´]\s*(\d{1,2})\s*[\/\-\.æœˆ]\s*(\d{1,2})\s*(?:æ—¥)?/);
    if (m){
      year = Number(m[1]); month = Number(m[2]); day = Number(m[3]); hasYear = true;
    } else {
      // 2) M/D
      m = s.match(/(\d{1,2})\s*\/\s*(\d{1,2})/);
      if (m){
        year = Number(baseYear); month = Number(m[1]); day = Number(m[2]);
      } else {
        // 3) MæœˆDæ—¥
        m = s.match(/(\d{1,2})\s*æœˆ\s*(\d{1,2})\s*æ—¥/);
        if (m){
          year = Number(baseYear); month = Number(m[1]); day = Number(m[2]);
        } else {
          // 4) YYYY/MM/DD
          m = s.match(/(\d{4})\s*\/\s*(\d{1,2})\s*\/\s*(\d{1,2})/);
          if (m){
            year = Number(m[1]); month = Number(m[2]); day = Number(m[3]); hasYear = true;
          }
        }
      }
    }

    if (!year || !month || !day) return { ok:false };

    if (hasTime){
      if (!(hour>=0 && hour<=23 && minute>=0 && minute<=59)) return { ok:false };
    }

    return { ok:true, year, month, day, hour, minute, hasTime, hasYear };
  }

  function makeDate(y,m,d,h,mi){
    const dt = new Date(y, m-1, d, h, mi, 0, 0);
    if (dt.getFullYear()!==y || (dt.getMonth()+1)!==m || dt.getDate()!==d) return null;
    return dt;
  }

  function monthDayKey(month, day){ return month*100 + day; }

  function toDatetimeLocalValue(d){
    const y = d.getFullYear();
    const m = pad2(d.getMonth()+1);
    const da= pad2(d.getDate());
    const h = pad2(d.getHours());
    const mi= pad2(d.getMinutes());
    return `${y}-${m}-${da}T${h}:${mi}`;
  }

  function fromDatetimeLocalValue(v){
    const m = String(v||'').match(/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2})$/);
    if (!m) return null;
    return makeDate(Number(m[1]), Number(m[2]), Number(m[3]), Number(m[4]), Number(m[5]));
  }

  function getBaseYear(){
    const by = document.getElementById("baseYear");
    return (by?.value || DEFAULT_BASE_YEAR).toString();
  }

  function wirePickers(){
    const map = [
      { textId:"dtStartIn", pickerId:"dtStartPicker", defaultTime:"10:00" },
      { textId:"dtEndIn",   pickerId:"dtEndPicker",   defaultTime:"20:00" },
      { textId:"dtWishIn",  pickerId:"dtWishPicker",  defaultTime:"17:00" },
    ];

    for (const it of map){
      const textEl = document.getElementById(it.textId);
      const pickEl = document.getElementById(it.pickerId);
      if (!textEl || !pickEl) continue;

      // â˜… dt-pickerå…¨ä½“ã‚¯ãƒªãƒƒã‚¯ã§å¿…ãšé–‹ãï¼ˆdatetime-localã®â€œå³å´ã ã‘é–‹ãâ€å•é¡Œã‚’æ½°ã™ï¼‰
      const wrap = pickEl.closest('.dt-picker');
      if (wrap){
        wrap.addEventListener("click", (e) => {
          e.preventDefault();
          e.stopPropagation();
          try{
            if (typeof pickEl.showPicker === "function") pickEl.showPicker();
            else pickEl.click();
          }catch(_){
            // noop
          }
        });
      }

      // ã‚¯ãƒªãƒƒã‚¯ç›´å‰ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œä¸­ï¼‰ã«åˆæœŸå€¤ã‚’ä»•è¾¼ã‚€ï¼šã“ã‚ŒãŒä¸€ç•ªå®‰å®š
      pickEl.addEventListener("pointerdown", () => {
        const baseYear = getBaseYear();
        const parsed = parseDateTimeLoose(textEl.value || "", baseYear);

        let init = null;
        if (parsed.ok){
          const [dh, dm] = (parsed.hasTime ? `${pad2(parsed.hour)}:${pad2(parsed.minute)}` : it.defaultTime)
            .split(":").map(Number);
          init = makeDate(parsed.year, parsed.month, parsed.day, dh, dm);
        } else {
          const now = new Date();
          const y = Number(baseYear);
          const [dh, dm] = it.defaultTime.split(":").map(Number);
          init = makeDate(y, now.getMonth()+1, now.getDate(), dh, dm) || new Date(y, now.getMonth(), now.getDate(), dh, dm, 0, 0);
        }

        pickEl.value = toDatetimeLocalValue(init);
      }, { passive:true });

      pickEl.addEventListener("change", () => {
        const dt = fromDatetimeLocalValue(pickEl.value);
        if (!dt) return;
        textEl.value = fmtYmdHm(dt);
      });
    }
  }

  // =============================
  //  å¤‰æ›ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ãƒ–ãƒ­ãƒƒã‚¯ã®ãƒœã‚¿ãƒ³ã§å…¨ä½“ã‚’æ›´æ–°ï¼‰
  // =============================
  (function(){
    const titleSet = document.querySelector('.set[data-set="title"]');
    if(!titleSet) return;

    const input  = titleSet.querySelector('.input');
    const outTitle = titleSet.querySelector('.output-title');
    const outAdmin = titleSet.querySelector('.output-admin');
    const btnConvert = titleSet.querySelector('.btn-convert');

    // meta
    const divisionEl = document.getElementById('division');
    const firstComeEl = document.getElementById('firstCome');

    // floor/brand
    const floorSet = document.querySelector('.set[data-set="floor-brand"]');
    const inFloor   = floorSet?.querySelector('.input-floor');
    const outFloor  = floorSet?.querySelector('.output-floor');
    const inBrand   = floorSet?.querySelector('.input-brand');
    const outBrand  = floorSet?.querySelector('.output-brand');

    // datetime
    const dtStartIn = document.getElementById("dtStartIn");
    const dtEndIn   = document.getElementById("dtEndIn");
    const dtWishIn  = document.getElementById("dtWishIn");

    const dtPublishStartOut = document.getElementById("dtPublishStartOut");
    const dtUsableStartOut  = document.getElementById("dtUsableStartOut");

    const dtEndOutCombined  = document.getElementById("dtEndOutCombined");
    const dtPublishEndOut   = document.getElementById("dtPublishEndOut");
    const dtUsableEndOut    = document.getElementById("dtUsableEndOut");

    // terms / notes
    const termsSet = document.querySelector('.set[data-set="terms"]');
    const inTerms  = termsSet?.querySelector('.input-terms');
    const outTerms = termsSet?.querySelector('.output-terms');

    const notesSet = document.querySelector('.set[data-set="notes"]');
    const inNotes  = notesSet?.querySelector('.input-notes');
    const outNotes = notesSet?.querySelector('.output-notes');

    // usage
    const overallLimitEl = document.getElementById('overallLimit');
    const overallTotalEl = document.getElementById('overallTotal');

    function parseFirstComeNumber(){
      const nRaw = (firstComeEl?.value ?? '').toString().trim();
      const digits = nRaw.replace(/[^\d]/g, '');
      const n = digits ? Number(digits) : 0;
      return (Number.isFinite(n) && n >= 1) ? n : 0;
    }

    function buildTitleResult(baseText, firstComeNum){
      let t = transform(baseText).trim();
      if (firstComeNum >= 1) t += `â€»å…ˆç€${firstComeNum}åæ§˜`;
      return t;
    }

    function parseFloorAndPlace(floorText){
      const normalized = transform(floorText).replace(/[ ã€€]+/g,' ').trim();
      if (!normalized) return { floor: '', place: '' };

      const m = normalized.match(/^(åœ°ä¸‹\s*\d+éš|åœ°ä¸‹\d+éš|\d+éš|å±‹ä¸Š)\s*(.*)$/);
      if (!m) return { floor: '', place: normalized };

      const floor = m[1].replace(/[ ã€€]+/g,'');
      const place = (m[2] || '').trim();
      return { floor, place };
    }

    function buildBrandResult(place, brandText){
      const b = transform(brandText).trim();
      if (b){
        if (place) return `${place}ï¼»${b}ï¼½`;
        return `ï¼»${b}ï¼½`;
      }
      return place || '';
    }

    function applyUsageFromFirstCome(firstComeNum){
      if (!overallLimitEl || !overallTotalEl) return;

      if (firstComeNum >= 1){
        overallLimitEl.value = 'ã‚ã‚Š';
        overallTotalEl.value = String(firstComeNum);
      } else {
        overallLimitEl.value = 'ãªã—';
        overallTotalEl.value = '';
      }
    }

    function applyDatetime(){
      if (!dtStartIn || !dtEndIn) return;

      const baseYear = getBaseYear();

      const pStart = parseDateTimeLoose(dtStartIn.value || "", baseYear);
      const pEnd   = parseDateTimeLoose(dtEndIn.value || "", baseYear);

      const clearOut = () => {
        if (dtPublishStartOut) dtPublishStartOut.value = "";
        if (dtUsableStartOut)  dtUsableStartOut.value  = "";

        if (dtEndOutCombined)  dtEndOutCombined.value  = "";
        if (dtPublishEndOut)   dtPublishEndOut.value   = "";
        if (dtUsableEndOut)    dtUsableEndOut.value    = "";
      };

      if (!pStart.ok || !pEnd.ok){
        clearOut();
        return;
      }

      // é–‹å§‹ï¼šæ™‚åˆ»ãªã—â†’10:00
      const startH = pStart.hasTime ? pStart.hour : 10;
      const startM = pStart.hasTime ? pStart.minute : 0;

      // çµ‚äº†ï¼šæ™‚åˆ»ãªã—â†’20:00
      const endH = pEnd.hasTime ? pEnd.hour : 20;
      const endM = pEnd.hasTime ? pEnd.minute : 0;

      // å¹´è·¨ãï¼ˆçµ‚äº†ãŒé–‹å§‹ã‚ˆã‚Šå‰ãªã‚‰ç¿Œå¹´ï¼‰
      const startKey = monthDayKey(pStart.month, pStart.day);
      const endKey   = monthDayKey(pEnd.month, pEnd.day);
      const endYear  = (endKey < startKey) ? (pStart.year + 1) : pStart.year;

      const startDt = makeDate(pStart.year, pStart.month, pStart.day, startH, startM);
      const endDt   = makeDate(endYear, pEnd.month, pEnd.day, endH, endM);

      if (!startDt || !endDt){
        clearOut();
        return;
      }

      // å…¬é–‹é–‹å§‹ï¼ˆé…å¸ƒå¸Œæœ›ï¼‰
      let pubStartDt = null;
      const wishRaw = (dtWishIn?.value || "").trim();

      if (!wishRaw){
        // æœªè¨˜å…¥ï¼šé–‹å§‹ã®1æ—¥å‰ 17:00ï¼ˆå›ºå®šï¼‰
        pubStartDt = new Date(startDt.getTime());
        pubStartDt.setDate(pubStartDt.getDate() - 1);
        pubStartDt.setHours(17,0,0,0);
      } else {
        const pWish = parseDateTimeLoose(wishRaw, baseYear);
        if (pWish.ok){
          let wy = pWish.hasYear ? pWish.year : startDt.getFullYear();

          // è»½ã„è£œæ­£ï¼ˆå¹´ãªã—ã§ã€é–‹å§‹ãŒ1-2æœˆï¼†é…å¸ƒå¸Œæœ›ãŒ11-12æœˆãªã‚‰å‰å¹´å¯„ã›ï¼‰
          if (!pWish.hasYear){
            const wKey = monthDayKey(pWish.month, pWish.day);
            const sKey = monthDayKey(pStart.month, pStart.day);
            if (wKey > sKey && pStart.month <= 2 && pWish.month >= 11){
              wy = startDt.getFullYear() - 1;
            }
          }

          const wh = pWish.hasTime ? pWish.hour : 17;
          const wm = pWish.hasTime ? pWish.minute : 0;
          pubStartDt = makeDate(wy, pWish.month, pWish.day, wh, wm);
        }
      }

      // åæ˜ 
      if (dtUsableStartOut)  dtUsableStartOut.value  = fmtYmdHm(startDt);

      const endStr = fmtYmdHm(endDt);
      if (dtEndOutCombined)  dtEndOutCombined.value  = endStr;

      // çµ±åˆã ãŒã€å†…éƒ¨çš„ã«ã¯ä¸¡æ–¹åŒã˜å€¤ã¨ã—ã¦ä¿æŒï¼ˆå°†æ¥CMSã«åˆ†é…ã—ã‚„ã™ã„ï¼‰
      if (dtPublishEndOut)   dtPublishEndOut.value   = endStr;
      if (dtUsableEndOut)    dtUsableEndOut.value    = endStr;

      if (dtPublishStartOut) dtPublishStartOut.value = pubStartDt ? fmtYmdHm(pubStartDt) : "";
    }

    function onConvert(){
      const firstComeNum = parseFirstComeNumber();

      // ã‚¿ã‚¤ãƒˆãƒ«/ç®¡ç†åç§°
      const src = input.value || '';
      const titleResult = buildTitleResult(src, firstComeNum);

      const div = (divisionEl?.value ?? '').toString().trim();
      if (outTitle) outTitle.value = titleResult;
      if (outAdmin) outAdmin.value = (div ? (div + titleResult) : titleResult);

      // ãƒ•ãƒ­ã‚¢ãƒ»å£²å ´ / ãƒ–ãƒ©ãƒ³ãƒ‰å
      if (inFloor && outFloor && outBrand){
        const { floor, place } = parseFloorAndPlace(inFloor.value || '');
        outFloor.value = floor;

        const brandText = inBrand ? (inBrand.value || '') : '';
        outBrand.value = buildBrandResult(place, brandText);
      }

      // æ—¥æ™‚è¨­å®š
      applyDatetime();

      // ã”åˆ©ç”¨æ¡ä»¶ / æ³¨æ„äº‹é …
      if (outTerms && inTerms) outTerms.value = transform(inTerms.value || '').replace(/[ \t]+$/gm,'').trimEnd();
      if (outNotes && inNotes) outNotes.value = transform(inNotes.value || '').replace(/[ \t]+$/gm,'').trimEnd();

      // ã‚¯ãƒ¼ãƒãƒ³åˆ©ç”¨æ¡ä»¶
      applyUsageFromFirstCome(firstComeNum);

      toast('å¤‰æ›ã—ã¾ã—ãŸ');
    }

    if(btnConvert) btnConvert.addEventListener('click', onConvert);
    titleSet.addEventListener('keydown', (e)=>{
      if((e.ctrlKey||e.metaKey) && e.key==='Enter'){
        e.preventDefault();
        onConvert();
      }
    });
  })();

  // å³ä¸Šãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼ã‚¯ãƒªã‚¢ï¼ˆå…¨éƒ¨ã‚¯ãƒªã‚¢ï¼‰
  (function(){
    function setSelectByValueOrText(selectEl, valueOrText){
      if (!selectEl || selectEl.tagName !== 'SELECT') return false;
      const target = String(valueOrText ?? '').trim();
      if (!target) return false;

      const byValue = Array.from(selectEl.options).find(o => (o.value ?? '').trim() === target);
      if (byValue){
        selectEl.value = byValue.value;
        selectEl.dispatchEvent(new Event('input', { bubbles:true }));
        selectEl.dispatchEvent(new Event('change', { bubbles:true }));
        return true;
      }

      const byText = Array.from(selectEl.options).find(o => (o.textContent ?? '').trim() === target);
      if (byText){
        selectEl.value = byText.value;
        selectEl.dispatchEvent(new Event('input', { bubbles:true }));
        selectEl.dispatchEvent(new Event('change', { bubbles:true }));
        return true;
      }

      return false;
    }

    function setFieldByPanelTitle(panelH2Text, value){
      const t = String(panelH2Text ?? '').trim();
      if (!t) return false;

      const sets = Array.from(document.querySelectorAll('.set'));
      const couponSet =
        sets.find(s => (s.querySelector('.set-title')?.textContent || '').includes('ã‚¯ãƒ¼ãƒãƒ³åˆ©ç”¨æ¡ä»¶')) || null;

      const scope = couponSet || document;

      const panels = Array.from(scope.querySelectorAll('.panel'));
      const panel = panels.find(p => (p.querySelector('h2')?.textContent || '').trim() === t) || null;
      if (!panel) return false;

      const field = panel.querySelector('input, textarea');
      if (!field) return false;

      field.value = String(value ?? '');
      field.dispatchEvent(new Event('input', { bubbles:true }));
      field.dispatchEvent(new Event('change', { bubbles:true }));
      return true;
    }

    function applyDefaults(){
      // ã‚«ãƒ†ã‚´ãƒªã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼šã‚¢ãƒ—ãƒªã‚¯ãƒ¼ãƒãƒ³
      setSelectByValueOrText(document.getElementById('category'), 'ã‚¢ãƒ—ãƒªã‚¯ãƒ¼ãƒãƒ³');

      // ä¼šå“¡ã²ã¨ã‚ŠãŒåˆ©ç”¨å¯èƒ½ãªå›æ•°ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼š1
      const per = document.getElementById('perMemberLimit');
      if (per){
        per.value = '1';
        per.dispatchEvent(new Event('input', { bubbles:true }));
        per.dispatchEvent(new Event('change', { bubbles:true }));
      } else {
        setFieldByPanelTitle('ä¼šå“¡ã²ã¨ã‚ŠãŒåˆ©ç”¨å¯èƒ½ãªå›æ•°', '1');
      }

      // åŸºæº–å¹´ï¼šä¿å­˜å€¤ãŒã‚ã‚Œã°ãã‚Œã€ç„¡ã‘ã‚Œã°DEFAULTï¼ˆâ€»ãƒªã‚»ãƒƒãƒˆã§ä¿æŒï¼‰
      const by = document.getElementById("baseYear");
      if (by){
        const saved = localStorage.getItem(LS_BASE_YEAR_KEY);
        const val = (saved && saved.trim()) ? saved.trim() : DEFAULT_BASE_YEAR;
        if ([...by.options].some(o => o.value === val)) by.value = val;
      }
    }

    function clearAll(){
      var nodes = document.querySelectorAll('input, textarea, select');
      nodes.forEach(function(el){
        // â˜… data-persist ã¯ã‚¯ãƒªã‚¢ã—ãªã„
        if (el.getAttribute && el.getAttribute('data-persist') === '1') return;

        if (el.tagName === 'SELECT') el.selectedIndex = 0;
        else if (el.type === 'checkbox' || el.type === 'radio') el.checked = false;
        else el.value = '';
      });

      applyDefaults();
      toast('ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ');
    }

    var vb = document.getElementById('ver');
    if (vb) vb.addEventListener('click', function(e){ e.preventDefault(); clearAll(); });

    document.addEventListener('DOMContentLoaded', applyDefaults);
  })();
  </script>
</body>
</html>
